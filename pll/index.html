<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>SCHEME NORTENOS-14</title>
<style>
body {margin:0;font-family:Arial;color:white;display:flex;height:100vh;background:url('kk.png') no-repeat center center fixed;background-size:cover;position: relative;}
body::after {content:"";position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.5);z-index:0;}
#main,#sidebar{position:relative;z-index:1;}
#sidebar{width:180px;background:#111;display:flex;flex-direction:column;box-shadow:2px 0 5px black;display:none;}
#sidebar button{background:#111;color:white;border:none;padding:15px;text-align:left;cursor:pointer;font-weight:bold;}
#sidebar button:hover{background:red;}
#sidebar button.active{background:darkred;}
#main{flex:1;padding:20px;overflow-y:auto;display:none;}
.container{background:#111;padding:15px;border-radius:8px;margin-bottom:15px;}
input,select{width:90%;padding:8px;margin:5px;border:none;border-radius:6px;background:#1a1a1a;color:white;}
button{background:red;color:white;border:none;padding:8px;margin:5px;width:95%;font-weight:bold;cursor:pointer;border-radius:6px;}
button:hover{background:darkred;}
table{width:100%;border-collapse:collapse;background:#111;}
th,td{border:1px solid red;padding:8px;text-align:center;}
th{background:red;color:black;}
.historyItem{background:#222;border:1px solid red;border-radius:6px;padding:8px;margin:5px 0;font-family:'Courier New', monospace;display:flex;justify-content:space-between;}
.historyDate{color:lightgray;font-size:0.8em;}
.historyActivity{font-weight:bold;}
.historyPoints{color:lime;font-weight:bold;}
#loginContainer{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;position:fixed;width:100%;background:rgba(0,0,0,0.7);z-index:10;}
#loginContainer input{width:250px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginContainer">
  <h2>Autentificare</h2>
  <input type="text" id="loginUsername" placeholder="Nume">
  <input type="password" id="loginPassword" placeholder="Parola">
  <select id="loginFaction">
    <option value="Gang">Gang</option>
    <option value="Mafie">Mafie</option>
  </select>
  <button onclick="login()">Loghează-te</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <button class="tabBtn active" onclick="showTab('homeTab')">Home</button>
  <button class="tabBtn" onclick="showTab('profilTab')">Profil</button>
  <button class="tabBtn" onclick="showTab('clasamentTab')">Clasament</button>
  <button class="tabBtn" onclick="showTab('membersTab')">Membrii</button>
  <button class="tabBtn" id="adminTabBtn" style="display:none;" onclick="showTab('adminTab')">Admin</button>
</div>

<!-- MAIN -->
<div id="main">
  <!-- HOME TAB -->
  <div id="homeTab" class="tab">
    <div class="container">
      <h2>Profil</h2>
      <p><b>Nume:</b> <span id="homeName">-</span></p>
      <p><b>Puncte:</b> <span id="homePoints">0</span></p>
    </div>
  </div>

  <!-- PROFIL TAB -->
  <div id="profilTab" class="tab" style="display:none;">
    <div class="container">
      <h2>Profil</h2>
      <p><b>Nume:</b> <span id="profileName">-</span></p>
      <p><b>Puncte:</b> <span id="profilePoints">0</span></p>
      <h3>Istoric activități</h3>
      <button onclick="refreshHistory()">Refresh Istoric</button>
      <div id="profileHistory"></div>
    </div>
  </div>

  <!-- CLASAMENT TAB -->
  <div id="clasamentTab" class="tab" style="display:none;">
    <div class="container">
      <h2>Clasament Oficial</h2>
      <table>
        <thead>
          <tr><th>#</th><th>Membru</th><th>Puncte</th></tr>
        </thead>
        <tbody id="leaderboard"></tbody>
      </table>
    </div>
  </div>

  <!-- MEMBRII TAB -->
  <div id="membersTab" class="tab" style="display:none;">
    <div class="container">
      <h2>Membrii</h2>
      <table>
        <thead><tr><th>Nume</th><th>Mafie/Gang</th></tr></thead>
        <tbody id="membersList"></tbody>
      </table>
    </div>
  </div>

  <!-- ADMIN TAB -->
  <div id="adminTab" class="tab" style="display:none;">
    <div class="container">
      <h2>Panou Admin</h2>
      <input type="text" id="adminUser" placeholder="Nume membru">
      <input type="number" id="adminPoints" placeholder="Puncte de adaugat/scazut">
      <select id="adminFaction">
        <option value="Gang">Gang</option>
        <option value="Mafie">Mafie</option>
      </select>
      <button onclick="givePoints()">Aplică Puncte</button>
      <button onclick="changeFaction()">Schimbă Faction</button>
      <button onclick="deleteUser()">Șterge Cont</button>
    </div>
  </div>
</div>

<!-- FIREBASE COMPAT SDK -->
<script src="https://www.gstatic.com/firebasejs/12.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.10.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB3EZvNjLUNWw8mruH1voXl_sf16cEFoVs",
  authDomain: "nortenos-bf806.firebaseapp.com",
  databaseURL: "https://nortenos-bf806-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "nortenos-bf806",
  storageBucket: "nortenos-bf806.appspot.com",
  messagingSenderId: "274141810949",
  appId: "1:274141810949:web:c52c49206ae80701eb676c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let currentUser = null;

// INIT ADMIN
function initAdmin(){
  db.ref('users/vlad').once('value', snap => {
    if(!snap.exists()){
      db.ref('users/vlad').set({password:'vlad2020',points:0,isAdmin:true,faction:'Gang',history:[]});
    }
  });
}

// LOGIN FUNCTION
function login(){
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value.trim();
  const faction = document.getElementById('loginFaction').value;
  const msg = document.getElementById('loginMsg');
  msg.textContent = "";
  if(!username || !password){ msg.textContent = "Completează toate câmpurile!"; return; }

  db.ref('users/' + username).once('value', snap => {
    if(snap.exists()){
      const data = snap.val();
      if(data.password === password){
        currentUser = username;
        document.getElementById('loginContainer').style.display='none';
        document.getElementById('sidebar').style.display='flex';
        document.getElementById('main').style.display='block';
        if(data.isAdmin) document.getElementById('adminTabBtn').style.display='block';
        loadDashboard();
      } else { msg.textContent="Parolă greșită!"; }
    } else {
      // Crează cont nou
      db.ref('users/' + username).set({password:password,points:0,isAdmin:false,faction:faction,history:[]}, ()=>{
        currentUser = username;
        document.getElementById('loginContainer').style.display='none';
        document.getElementById('sidebar').style.display='flex';
        document.getElementById('main').style.display='block';
        loadDashboard();
      });
    }
  });
}

// TABURI
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
  document.querySelector(`[onclick="showTab('${id}')"]`).classList.add('active');
}

// DASHBOARD
function loadDashboard(){
  const homeName = document.getElementById('homeName');
  const homePoints = document.getElementById('homePoints');
  const profileName = document.getElementById('profileName');
  const profilePoints = document.getElementById('profilePoints');
  const profileHistory = document.getElementById('profileHistory');

  db.ref('users/' + currentUser).on('value', snap => {
    const data = snap.val();
    homeName.textContent = currentUser;
    homePoints.textContent = data.points;
    profileName.textContent = currentUser;
    profilePoints.textContent = data.points;
    refreshHistory();
  });

  updateLeaderboard();
  updateMembers();
}

// REFRESH ISTORIC
function refreshHistory(){
  const profileHistory = document.getElementById('profileHistory');
  profileHistory.innerHTML = "";
  db.ref('users/' + currentUser + '/history').once('value', snap=>{
    const data = snap.val() || [];
    data.forEach(h=>{
      const div = document.createElement('div');
      div.className='historyItem';
      div.innerHTML=`<span class="historyActivity">${h.activity}</span> <span class="historyPoints">${h.points}</span> <span class="historyDate">${h.date}</span>`;
      profileHistory.appendChild(div);
    });
  });
}

// LEADERBOARD
function updateLeaderboard(){
  const lb = document.getElementById('leaderboard');
  lb.innerHTML = "";
  db.ref('users').once('value', snap=>{
    const arr = [];
    snap.forEach(child=>{
      arr.push({name:child.key, points:child.val().points});
    });
    arr.sort((a,b)=>b.points-a.points);
    arr.forEach((u,i)=>{
      lb.innerHTML += `<tr><td>${i+1}</td><td>${u.name}</td><td>${u.points}</td></tr>`;
    });
  });
}

// MEMBERS
function updateMembers(){
  const ml = document.getElementById('membersList');
  ml.innerHTML = "";
  db.ref('users').once('value', snap=>{
    snap.forEach(child=>{
      ml.innerHTML += `<tr><td>${child.key}</td><td>${child.val().faction}</td></tr>`;
    });
  });
}

// ADMIN ACTIONS
function givePoints(){
  const user = document.getElementById('adminUser').value.trim();
  const pts = parseInt(document.getElementById('adminPoints').value);
  if(!user || isNaN(pts)) return;
  db.ref('users/' + user).once('value', snap=>{
    if(snap.exists()){
      const old = snap.val();
      const newPoints = old.points + pts;
      const newHistory = old.history || [];
      newHistory.push({activity:'Admin Points',points:pts,date:new Date().toLocaleString()});
      db.ref('users/' + user).update({points:newPoints,history:newHistory}, ()=>{
        refreshHistory();
        updateLeaderboard();
      });
    }
  });
}

function changeFaction(){
  const user = document.getElementById('adminUser').value.trim();
  const faction = document.getElementById('adminFaction').value;
  if(!user) return;
  db.ref('users/' + user).update({faction:faction}, updateMembers);
}

function deleteUser(){
  const user = document.getElementById('adminUser').value.trim();
  if(!user) return;
  db.ref('users/' + user).remove(()=>{
    refreshHistory();
    updateLeaderboard();
    updateMembers();
  });
}

initAdmin();
</script>
</body>
</html>